{"version":3,"file":"index.umd.js","sources":["../src/vird/src/vird-node-types.ts","../src/vird/src/vird-node-creators.ts","../src/vird/src/config.ts","../node_modules/@yattaki/event-handler/dist/index.js","../src/vird/src/vird-element.ts","../src/vird-dom/src/node-creators.ts","../src/vird-dom/src/diff.ts","../src/vird-dom/src/clear-fragment-node.ts","../src/vird-dom/src/renderer.ts"],"sourcesContent":["export interface VirdNodeTypes {\r\n  text: '#text'\r\n  comment: '#comment'\r\n  fragment: 'document-fragment'\r\n}\r\n\r\nexport const virdNodeTypes: VirdNodeTypes = Object.defineProperties({}, {\r\n  text: { value: '#text' },\r\n  comment: { value: '#comment' },\r\n  fragment: { value: '#document-fragment' }\r\n})\r\n","import { VirdNode, VirdNodeText, VirdNodeComment, VirdNodeFragment } from './vird-node'\r\nimport { virdNodeTypes, VirdNodeTypes } from './vird-node-types'\r\n\r\nexport function cloneVirdNode<R extends VirdNode> (virdNode: R, deep = false): R {\r\n  const type = virdNodeTypes.text\r\n  const properties = { ...virdNode.properties }\r\n  const children = deep ? virdNode.children.map(child => cloneVirdNode(child)) : []\r\n\r\n  return { type, properties, children } as R\r\n}\r\n\r\nexport function createVirdText (text = ''): VirdNodeText {\r\n  const type = virdNodeTypes.text\r\n  const properties = { textContent: text }\r\n  const children: never[] = []\r\n\r\n  return { type, properties, children }\r\n}\r\n\r\nexport function createVirdComment (comment = ''): VirdNodeComment {\r\n  const type = virdNodeTypes.comment\r\n  const properties = { textContent: comment }\r\n  const children: never[] = []\r\n\r\n  return { type, properties, children }\r\n}\r\n\r\nexport function createVirdFragment (...children: VirdNode[]): VirdNodeFragment {\r\n  const type = virdNodeTypes.fragment\r\n  const properties = {}\r\n\r\n  return { type, properties, children }\r\n}\r\n\r\nexport function createVirdNode (type: VirdNodeTypes['text'], properties?: VirdNodeText['properties']): VirdNodeText\r\nexport function createVirdNode (type: VirdNodeTypes['comment'], properties?: VirdNodeComment['properties']): VirdNodeComment\r\nexport function createVirdNode (type: VirdNodeTypes['fragment'], children?: string | (string | VirdNode)[]): VirdNodeFragment\r\nexport function createVirdNode (type: string, children: string | (string | VirdNode)[]): VirdNode\r\nexport function createVirdNode (type: string, properties: VirdNode['properties'], children?: string | (string | VirdNode)[]): VirdNode\r\nexport function createVirdNode (type: string, properties?: VirdNode['properties'] | string | (string | VirdNode)[], children?: string | (string | VirdNode)[]): VirdNode\r\nexport function createVirdNode (type: string, properties?: VirdNode['properties'] | string | (string | VirdNode)[], children?: string | (string | VirdNode)[]): VirdNode {\r\n  if (typeof properties !== 'object' || Array.isArray(properties)) {\r\n    children = properties\r\n    properties = {}\r\n  }\r\n\r\n  let addChildren: VirdNode[]\r\n  if (typeof children === 'string') {\r\n    addChildren = [createVirdText(children)]\r\n  } else if (Array.isArray(children)) {\r\n    addChildren = children.map(child => typeof child === 'string' ? createVirdText(child) : child)\r\n  } else {\r\n    addChildren = []\r\n  }\r\n\r\n  return { type, properties, children: addChildren }\r\n}\r\n","export interface VirdConfig {\n  binding: RegExp | null\n}\n\nexport const config: VirdConfig = {\n  binding: /{\\s*([^\\s:}]+)(?:\\s*:\\s*((?:[^\\s}]|\\s+[^}])*))?\\s*}/\n}\n","class EventHandler {\n    constructor() {\n        this._map = new Map();\n    }\n    /**\n     * Add a new listener.\n     * @param type This represents the name of the event.\n     * @param listener This represents the listener to add.\n     * @param options Specifies characteristics about the event listener.\n     */\n    addEventListener(type, listener, options = {}) {\n        let onMaps = this._map.get(type);\n        if (!onMaps) {\n            onMaps = [];\n            this._map.set(type, onMaps);\n        }\n        let isAdd = true;\n        for (const onMap of onMaps) {\n            if (onMap.listener === listener) {\n                onMap.options = options;\n                isAdd = false;\n                break;\n            }\n        }\n        if (isAdd) {\n            onMaps.push({ listener, options });\n        }\n        return isAdd;\n    }\n    /**\n     * Remove the listener.\n     * @param type This represents the name of the event.\n     * @param listener This represents the listener to remove.\n     */\n    removeEventListener(type, listener) {\n        const onMaps = this._map.get(type);\n        if (onMaps) {\n            let index = 0;\n            for (const onMap of onMaps) {\n                if (onMap.listener === listener) {\n                    onMaps.splice(index, 1);\n                    return true;\n                }\n                index++;\n            }\n        }\n        return false;\n    }\n    /**\n     * Execute the registered event.\n     * @param type This represents the name of the event.\n     * @param data An object to be passed as an argument of the listener.\n     */\n    async dispatchEvent(type, data = {}) {\n        const promises = [];\n        const onMaps = this._map.get(type);\n        if (onMaps) {\n            for (const { listener, options } of [...onMaps]) {\n                const event = {\n                    type,\n                    target: this,\n                    data: { ...(options.data || {}), ...data }\n                };\n                const promise = listener(event);\n                promises.push(promise);\n                if (options.once) {\n                    this.removeEventListener(type, listener);\n                }\n                if (options.wait) {\n                    await promise;\n                }\n            }\n        }\n        await Promise.all(promises);\n    }\n}\n\nexport default EventHandler;\n//# sourceMappingURL=index.js.map\n","import { VirdNode } from './vird-node'\r\nimport { cloneVirdNode } from './vird-node-creators'\r\nimport { config } from './config'\r\nimport EventHandler, { EventHandlerDataMap } from '@yattaki/event-handler'\r\n\r\nexport interface VirdElementEventMap extends EventHandlerDataMap {\r\n  mount: { parent: VirdElement }\r\n  unmount: { parent: VirdElement }\r\n  update: {}\r\n  'insert-children': { children: VirdElement[]; index: number }\r\n  'remove-children': { children: VirdElement[] }\r\n}\r\n\r\nexport class VirdElement<T extends { [key: string]: any } = { [key: string]: any }> extends EventHandler<VirdElementEventMap> {\r\n  readonly virdNode: VirdNode\r\n\r\n  private _parent: VirdElement | null = null\r\n  private _children: VirdElement[] = []\r\n  private _state: T = {} as T\r\n\r\n  acceptParentState = false\r\n\r\n  constructor (virdNode: VirdNode) {\r\n    super()\r\n\r\n    this.virdNode = virdNode\r\n    this.setChildren(virdNode.children.map((child) => new VirdElement(child)))\r\n\r\n    this.addEventListener('mount', (e) => {\r\n      for (const child of this.children) {\r\n        child.dispatchEvent('unmount', { parent: e.data.parent })\r\n      }\r\n    })\r\n\r\n    this.addEventListener('unmount', (e) => {\r\n      for (const child of this.children) {\r\n        child.dispatchEvent('unmount', { parent: e.data.parent })\r\n      }\r\n    })\r\n  }\r\n\r\n  insertAfter (beforeChild: VirdElement | null, ...children: VirdElement[]) {\r\n    const newChildren = this.children\r\n\r\n    let index: number\r\n    if (beforeChild) {\r\n      index = newChildren.indexOf(beforeChild) + 1\r\n      if (index < 1) {\r\n        throw Error('The VirdElement before which the new VirdElement is to be inserted is not a child of this VirdElement.')\r\n      }\r\n    } else {\r\n      index = newChildren.length\r\n    }\r\n\r\n    newChildren.splice(index, 0, ...children)\r\n    this.setChildren(newChildren)\r\n    this.dispatchEvent('insert-children', { children, index })\r\n\r\n    return this\r\n  }\r\n\r\n  insertBefore (afterChild: VirdElement | null, ...children: VirdElement[]) {\r\n    return this.insertAfter(\r\n      afterChild ? afterChild.prev : this.firstChild,\r\n      ...children\r\n    )\r\n  }\r\n\r\n  appendChild (...children: VirdElement[]) {\r\n    return this.insertAfter(null, ...children)\r\n  }\r\n\r\n  removeChild (...children: VirdElement[]) {\r\n    const newChildren = this.children\r\n    for (const child of children) {\r\n      if (!newChildren.includes(child)) {\r\n        throw Error('The VirdElement to be removed is not a child of this VirdElement.')\r\n      }\r\n    }\r\n\r\n    this.setChildren(newChildren.filter((child) => !children.includes(child)))\r\n    this.dispatchEvent('remove-children', { children })\r\n\r\n    return this\r\n  }\r\n\r\n  remove () {\r\n    const parent = this.parent\r\n    if (parent) {\r\n      parent.removeChild(this)\r\n    }\r\n\r\n    return this\r\n  }\r\n\r\n  clearChildren () {\r\n    this.setChildren([])\r\n\r\n    return this\r\n  }\r\n\r\n  setChildren (children: VirdElement[]) {\r\n    const beforeChildren = this.children\r\n    this._children = children\r\n    this.virdNode.children = this.children.map((child) => child.virdNode)\r\n\r\n    for (const child of beforeChildren) {\r\n      if (children.includes(child)) { continue }\r\n      child._parent = null\r\n      this.dispatchEvent('unmount', { parent: this })\r\n    }\r\n\r\n    for (const child of children) {\r\n      if (beforeChildren.includes(child)) { continue }\r\n      child._parent = this\r\n      this.dispatchEvent('mount', { parent: this })\r\n    }\r\n\r\n    this.update()\r\n\r\n    return beforeChildren\r\n  }\r\n\r\n  clone (deep = false) {\r\n    const virdNode = cloneVirdNode(this.virdNode, deep)\r\n\r\n    const virdElement = new VirdElement(virdNode)\r\n    virdElement.setState(this.state, false)\r\n\r\n    return virdElement\r\n  }\r\n\r\n  getVirdElements (\r\n    getter: (VirdElement: VirdElement) => boolean,\r\n    includeThis = false\r\n  ) {\r\n    const hitVirdElements: VirdElement[] = []\r\n\r\n    if (includeThis && getter(this)) {\r\n      hitVirdElements.push(this)\r\n    }\r\n\r\n    for (const child of this.children) {\r\n      if (getter(child)) {\r\n        hitVirdElements.push(child)\r\n      }\r\n    }\r\n\r\n    return hitVirdElements\r\n  }\r\n\r\n  update () {\r\n    this.dispatchEvent('update')\r\n  }\r\n\r\n  setState (state: T, update = true) {\r\n    const beforeState = this._state\r\n    for (const key of Object.keys(state)) {\r\n      if (this.state[key] === state[key]) { continue }\r\n\r\n      this._state = { ...this.state, ...state }\r\n      break\r\n    }\r\n\r\n    if (update && beforeState !== this._state) { this.update() }\r\n  }\r\n\r\n  getParentState (deep = true) {\r\n    const parentStates: VirdElement['state'][] = [this.state]\r\n    const pushParentState = (virdElement: VirdElement | null) => {\r\n      if (!virdElement) { return }\r\n\r\n      parentStates.push(virdElement.state)\r\n\r\n      if (!deep || !virdElement.acceptParentState) { return }\r\n      pushParentState(virdElement.parent)\r\n    }\r\n\r\n    pushParentState(this.parent)\r\n\r\n    let catchState: VirdElement['state'] = {}\r\n    for (const parentState of parentStates) {\r\n      catchState = { ...parentState, ...catchState }\r\n    }\r\n    return catchState\r\n  }\r\n\r\n  setAcceptParentStateOfChildren (bool: boolean) {\r\n    for (const child of this.children) {\r\n      child.acceptParentState = bool\r\n      child.setAcceptParentStateOfChildren(bool)\r\n    }\r\n  }\r\n\r\n  get parent () {\r\n    return this._parent\r\n  }\r\n\r\n  get children () {\r\n    return [...this._children]\r\n  }\r\n\r\n  set children (value) {\r\n    this.setChildren(value)\r\n  }\r\n\r\n  get firstChild () {\r\n    return (this.children[0] || null) as VirdElement | null\r\n  }\r\n\r\n  get lastChild () {\r\n    const children = this.children\r\n    return (children[children.length - 1] || null) as VirdElement | null\r\n  }\r\n\r\n  get next () {\r\n    const parent = this.parent\r\n    if (!parent) {\r\n      return null\r\n    }\r\n\r\n    const children = parent.children\r\n    return children[children.indexOf(this) + 1] || null\r\n  }\r\n\r\n  get prev () {\r\n    const parent = this.parent\r\n    if (!parent) {\r\n      return null\r\n    }\r\n\r\n    const children = parent.children\r\n    return children[children.indexOf(this) - 1] || null\r\n  }\r\n\r\n  get state () {\r\n    return this._state\r\n  }\r\n\r\n  set state (value) {\r\n    this._state = value\r\n  }\r\n\r\n  get type () {\r\n    return this.virdNode.type\r\n  }\r\n\r\n  set type (value) {\r\n    this.virdNode.type = value\r\n    this.update()\r\n  }\r\n\r\n  get properties () {\r\n    let resultProperties: VirdNode['properties'] = {}\r\n    const properties = { ...this.virdNode.properties }\r\n    if (config.binding) {\r\n      const mergeState = this.getParentState()\r\n\r\n      const replacer = (_: string, key: string, defaultValue = '') =>\r\n        key in mergeState\r\n          ? String(mergeState[key])\r\n          : defaultValue\r\n\r\n      for (const key of Object.keys(properties)) {\r\n        const value = properties[key]\r\n        resultProperties[key] = value.replace(config.binding, replacer)\r\n      }\r\n    } else {\r\n      resultProperties = properties\r\n    }\r\n\r\n    return resultProperties\r\n  }\r\n\r\n  set properties (value) {\r\n    this.virdNode.properties = value\r\n    this.update()\r\n  }\r\n}\r\n","import {\n  createVirdNode,\n  VirdNode,\n  VirdNodeTypes,\n  virdNodeTypes,\n  VirdNodeComment,\n  VirdNodeText,\n  VirdNodeFragment,\n  VirdElement\n} from '../../vird/index'\n\nexport function createNode (node: Node, trim?: boolean): VirdNode\nexport function createNode (type: VirdNodeTypes['text'], properties?: VirdNodeText['properties']): VirdNodeText\nexport function createNode (type: VirdNodeTypes['comment'], properties?: VirdNodeComment['properties']): VirdNodeComment\nexport function createNode (type: VirdNodeTypes['fragment'], children?: string | (string | VirdNode)[]): VirdNodeFragment\nexport function createNode (type: string, children: string | (string | VirdNode)[]): VirdNode\nexport function createNode (type: string, properties: VirdNode['properties'], children?: string | (string | VirdNode)[]): VirdNode\nexport function createNode (type: string, properties?: VirdNode['properties'] | string | (string | VirdNode)[], children?: string | (string | VirdNode)[]): VirdNode\nexport function createNode (\n  nodeOrType: string | Node,\n  propertiesOrTrim?: VirdNode['properties'] | string | (string | VirdNode)[] | boolean,\n  children?: string | (string | VirdNode)[]\n): VirdNode\nexport function createNode (\n  nodeOrType: string | Node,\n  propertiesOrTrim: VirdNode['properties'] | string | (string | VirdNode)[] | boolean = false,\n  children?: string | (string | VirdNode)[]\n): VirdNode {\n  if (typeof nodeOrType === 'string') {\n    if (typeof propertiesOrTrim === 'boolean') { propertiesOrTrim = {} }\n    return createVirdNode(nodeOrType, propertiesOrTrim, children)\n  } else {\n    const node = nodeOrType\n    const type = node.nodeName.toLocaleLowerCase()\n    const properties: VirdNode['properties'] = {}\n    if (node instanceof Element) {\n      for (const { name, value } of node.attributes) {\n        properties[name] = value\n      }\n    } else if (!(node instanceof DocumentFragment)) {\n      properties.textContent = node.textContent || ''\n    }\n\n    const trim = !!propertiesOrTrim\n    let children = [...node.childNodes].map(node => createNode(node, trim))\n    if (trim) {\n      const filter = (virdNode: VirdNode) =>\n        virdNode.type !== virdNodeTypes.comment &&\n        (virdNode.type !== virdNodeTypes.text || !/^\\s*$/.test(virdNode.properties.textContent))\n\n      children = children.filter(filter)\n    }\n\n    return createVirdNode(type, properties, children)\n  }\n}\n\nexport function createElement (node: Node, trim?: boolean): VirdElement\nexport function createElement (type: string, children: string | (string | VirdNode)[]): VirdElement\nexport function createElement (type: string, properties: VirdNode['properties'], children?: string | (string | VirdNode)[]): VirdElement\nexport function createElement (type: string, properties?: VirdNode['properties'] | string | (string | VirdNode)[], children?: string | (string | VirdNode)[]): VirdElement\nexport function createElement (\n  nodeOrType: string | Node,\n  propertiesOrTrim?: VirdNode['properties'] | string | (string | VirdNode)[] | boolean,\n  children?: string | (string | VirdNode)[]\n): VirdNode {\n  const virdNode = createNode(nodeOrType, propertiesOrTrim, children)\n\n  return new VirdElement(virdNode)\n}\n","export function diff<T = { [key: string]: any }> (checkObject?: T, comparisonObjet?: T) {\r\n  const diffObject: { [key: string]: [T[keyof T] | undefined, T[keyof T] | undefined] } = {}\r\n\r\n  if (checkObject !== comparisonObjet) {\r\n    if (checkObject) {\r\n      if (comparisonObjet) {\r\n        const checkObjectKeys = Object.keys(checkObject)\r\n        const comparisonObjetKeys = Object.keys(comparisonObjet)\r\n\r\n        const keys = new Set([...checkObjectKeys, ...comparisonObjetKeys]) as Set<Extract<keyof T, string>>\r\n        for (const key of keys) {\r\n          const checkObjetValue = checkObject[key]\r\n          const comparisonObjetValue = comparisonObjet[key]\r\n          if (checkObjetValue === comparisonObjetValue) { continue }\r\n\r\n          diffObject[key] = [checkObjetValue, comparisonObjetValue]\r\n        }\r\n      } else {\r\n        for (const key of Object.keys(checkObject)) {\r\n          const value = checkObject[key as keyof T]\r\n          diffObject[key] = [value, undefined]\r\n        }\r\n      }\r\n    } else {\r\n      if (comparisonObjet) {\r\n        for (const key of Object.keys(comparisonObjet)) {\r\n          const value = comparisonObjet[key as keyof T]\r\n          diffObject[key] = [undefined, value]\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return diffObject as { [K in keyof T]: [T[K] | undefined, T[K] | undefined] }\r\n}\r\n","import { VirdNode } from '../../vird/index'\r\nimport { virdNodeTypes } from '../../vird/src/vird-node-types'\r\n\r\nexport function clearFragmentNode (virdNodes: VirdNode[]) {\r\n  const result: VirdNode[] = []\r\n\r\n  const pushVirdNodes: VirdNode[] = []\r\n  for (const virdNode of virdNodes) {\r\n    if (virdNode.type === virdNodeTypes.fragment) {\r\n      const children = clearFragmentNode(virdNode.children)\r\n      result.push(...children)\r\n      pushVirdNodes.push(...children)\r\n    } else {\r\n      result.push(virdNode)\r\n      pushVirdNodes.push(virdNode)\r\n    }\r\n  }\r\n\r\n  return result\r\n}\r\n","import { VirdNode, VirdElement, cloneVirdNode, virdNodeTypes } from '../../vird/index'\r\nimport { createNode } from './node-creators'\r\nimport { diff } from './diff'\r\nimport { clearFragmentNode } from './clear-fragment-node'\r\n\r\nexport type RenderItem = VirdNode | ((node: Node) => VirdNode)\r\nexport type PropertyValueMap = { newValue?: string, oldValue?: string }\r\nexport type PropertyTypeBinder = (node: Node, value: PropertyValueMap) => void\r\nexport type PropertyTypeRegExpBinder = (node: Node, matchArray: RegExpMatchArray, value: PropertyValueMap) => string\r\nexport type CustomNodeCreator = (virdNode: VirdNode) => Node\r\n\r\nexport class Renderer {\r\n  private readonly _renderMap: WeakMap<Node, VirdNode[]> = new Map()\r\n  private readonly _oldVirdNodeMap: WeakMap<Node, VirdNode[]> = new Map()\r\n  private readonly _nodeMap: WeakMap<VirdNode, Node> = new WeakMap()\r\n  private readonly _nodeCreatorMap: WeakMap<Node, CustomNodeCreator> = new WeakMap()\r\n  private _propertyTypeBinderMap: Map<string, PropertyTypeBinder> = new Map()\r\n  private _propertyTypeRegExpBinderMap: Map<RegExp, PropertyTypeRegExpBinder> = new Map()\r\n  private _customNodeCreatorMap: Map<string, CustomNodeCreator> = new Map()\r\n\r\n  constructor () {\r\n    this.setCustomNode(virdNodeTypes.text, () => document.createTextNode(''))\r\n    this.setCustomNode(virdNodeTypes.comment, () => document.createComment(''))\r\n    this.setCustomNode(virdNodeTypes.fragment, () => document.createCDATASection(''))\r\n    this.setPropertyTypeBind('textContent', (node, value) => { node.textContent = value.newValue || '' })\r\n  }\r\n\r\n  private _updateNode (node: Node, newProperties?: VirdNode['properties'], oldProperties?: VirdNode['properties']) {\r\n    const diffObject = diff(newProperties, oldProperties)\r\n\r\n    for (const type of Object.keys(diffObject)) {\r\n      const [newValue, oldValue] = diffObject[type]\r\n\r\n      let isMatch = false\r\n      for (const [regExp, propertyTypeRegExpBinder] of this._propertyTypeRegExpBinderMap) {\r\n        const matchArray = type.match(regExp)\r\n        if (matchArray) {\r\n          isMatch = true\r\n          propertyTypeRegExpBinder(node, matchArray, { newValue, oldValue })\r\n          break\r\n        }\r\n      }\r\n\r\n      if (!isMatch) {\r\n        const propertyTypeBinder = this._propertyTypeBinderMap.get(type)\r\n        if (propertyTypeBinder) {\r\n          propertyTypeBinder(node, { newValue, oldValue })\r\n        } else if (node instanceof Element) {\r\n          if (newValue) {\r\n            node.setAttribute(type, newValue)\r\n          } else {\r\n            node.removeAttribute(type)\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  render (node: Node, ...renderItems: RenderItem[]) {\r\n    const renderVirdNodes = renderItems.map(item => typeof item === 'function' ? item(node) : item)\r\n    const newVirdNodes = clearFragmentNode(renderVirdNodes)\r\n    const oldVirdNodes = this.getChildrenVirdNode(node)\r\n    const childNodes = [...node.childNodes]\r\n    this._renderMap.set(node, renderVirdNodes)\r\n    this._oldVirdNodeMap.set(node, newVirdNodes.map(virdNode => cloneVirdNode(virdNode)))\r\n\r\n    let i = 0\r\n    const maxIndex = Math.max(childNodes.length, newVirdNodes.length)\r\n    while (i < maxIndex) {\r\n      const oldVirdNode = (oldVirdNodes[i] || null) as VirdNode | null\r\n      const newVirdNode = (newVirdNodes[i] || null) as VirdNode | null\r\n      const childNode = (childNodes[i] || null) as Node | null\r\n\r\n      let newNode: Node | null = null\r\n      if (newVirdNode) {\r\n        if (newVirdNode instanceof VirdElement) {\r\n          newVirdNode.addEventListener('update', () => { this.reRender(node) })\r\n        }\r\n\r\n        if (!oldVirdNode || oldVirdNode.type !== newVirdNode.type) {\r\n          newNode = this.createNode(newVirdNode)\r\n\r\n          if (childNode) {\r\n            node.replaceChild(newNode, childNode)\r\n          } else {\r\n            node.appendChild(newNode)\r\n          }\r\n        } else {\r\n          newNode = childNode\r\n        }\r\n      } else {\r\n        if (childNode) {\r\n          node.removeChild(childNode)\r\n        }\r\n      }\r\n\r\n      if (newNode) {\r\n        this._updateNode(\r\n          newNode, newVirdNode ? newVirdNode.properties : undefined,\r\n          oldVirdNode ? oldVirdNode.properties : undefined\r\n        )\r\n\r\n        if (newVirdNode && newVirdNode.children.length > 0) {\r\n          this.render(newNode, ...newVirdNode.children)\r\n        }\r\n      }\r\n\r\n      i++\r\n    }\r\n\r\n    return newVirdNodes\r\n  }\r\n\r\n  renderDom (node: Node, trim = false) {\r\n    const virdNodes = createNode(node, trim).children\r\n\r\n    return this.render(node, ...virdNodes)\r\n  }\r\n\r\n  reRender (node: Node) {\r\n    const virdNodes = this._renderMap.get(node)\r\n    if (virdNodes) { this.render(node, ...virdNodes) }\r\n  }\r\n\r\n  createDispatcher (node: Node) {\r\n    return async (beforeCallback?: () => void | Promise<void>) => {\r\n      if (beforeCallback) { await beforeCallback() }\r\n\r\n      this.reRender(node)\r\n    }\r\n  }\r\n\r\n  createEffect<T = any> (node: Node, effect: (value?: T) => T | Promise<T>, initValue?: T) {\r\n    const dispatcher = this.createDispatcher(node)\r\n\r\n    return {\r\n      value: initValue,\r\n      setEffect (value: T) {\r\n        dispatcher(async () => { this.value = await effect(value) })\r\n      }\r\n    }\r\n  }\r\n\r\n  createNode (virdNode: VirdNode) {\r\n    let createNode: Node | undefined\r\n    const realNode = this._nodeMap.get(virdNode)\r\n    if (realNode) { createNode = realNode }\r\n\r\n    const beforeCreator = createNode ? this._nodeCreatorMap.get(createNode) : undefined\r\n    const creator = this._customNodeCreatorMap.get(virdNode.type)\r\n    if (beforeCreator !== creator && creator) {\r\n      createNode = creator(virdNode)\r\n    }\r\n\r\n    if (!createNode) { createNode = document.createElement(virdNode.type) }\r\n\r\n    this._nodeMap.set(virdNode, createNode)\r\n\r\n    return createNode\r\n  }\r\n\r\n  clone () {\r\n    const renderer = new Renderer()\r\n\r\n    for (const [regExp, binder] of this._propertyTypeRegExpBinderMap) {\r\n      renderer.setPropertyTypeRegExpBind(regExp, binder)\r\n    }\r\n\r\n    for (const [type, binder] of this._propertyTypeBinderMap) {\r\n      renderer.setPropertyTypeBind(type, binder)\r\n    }\r\n  }\r\n\r\n  getNode (virdNode: VirdNode) {\r\n    return this._nodeMap.get(virdNode) || null\r\n  }\r\n\r\n  getChildrenVirdNode (node: Node) {\r\n    return this._oldVirdNodeMap.get(node) || []\r\n  }\r\n\r\n  setCustomNode (type: string, creator: CustomNodeCreator) {\r\n    this._customNodeCreatorMap.set(type, creator)\r\n\r\n    return this\r\n  }\r\n\r\n  removeCustomNode (type: string) {\r\n    this._customNodeCreatorMap.delete(type)\r\n\r\n    return this\r\n  }\r\n\r\n  setPropertyTypeRegExpBind (regExp: RegExp, binder: PropertyTypeRegExpBinder) {\r\n    this.removePropertyTypeRegExpBind(regExp)\r\n    this._propertyTypeRegExpBinderMap.set(regExp, binder)\r\n\r\n    return this\r\n  }\r\n\r\n  removePropertyTypeRegExpBind (regExp: RegExp) {\r\n    for (const key of this._propertyTypeRegExpBinderMap.keys()) {\r\n      if (String(key) !== String(regExp)) { continue }\r\n\r\n      this._propertyTypeRegExpBinderMap.delete(regExp)\r\n      break\r\n    }\r\n\r\n    return this\r\n  }\r\n\r\n  setPropertyTypeBind (type: string, binder: PropertyTypeBinder) {\r\n    this._propertyTypeBinderMap.set(type, binder)\r\n\r\n    return this\r\n  }\r\n\r\n  removePropertyTypeBind (type: string) {\r\n    this._propertyTypeBinderMap.delete(type)\r\n\r\n    return this\r\n  }\r\n}\r\n\r\nexport const renderer = new Renderer()\r\n"],"names":[],"mappings":"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"}